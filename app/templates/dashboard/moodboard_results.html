<!DOCTYPE html>
<html class="dark" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Visioneer - Moodboard Generated</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#1919e6",
                        "background-light": "#f6f6f8",
                        "background-dark": "#111121",
                    },
                    fontFamily: {
                        display: ["Space Grotesk"],
                    },
                    borderRadius: { DEFAULT: "0.25rem", lg: "0.5rem", xl: "0.75rem", full: "9999px" },
                },
            },
        };
    </script>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-gray-800 dark:text-gray-200">
    <div class="flex flex-col min-h-screen">
        <header class="border-b border-gray-200 dark:border-gray-800">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center gap-4">
                        <svg class="h-6 w-6 text-primary" fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
                            <path d="M44 4H30.6666V17.3334H17.3334V30.6666H4V44H44V4Z" fill="currentColor"></path>
                        </svg>
                        <h1 class="text-xl font-bold text-gray-900 dark:text-white">Visioneer</h1>
                    </div>
                    <nav class="hidden md:flex items-center gap-8">
                        <a class="text-sm font-medium hover:text-primary dark:hover:text-primary" href="{{ url_for('main.dashboard') }}">Home</a>
                        <a class="text-sm font-medium hover:text-primary dark:hover:text-primary" href="{{ url_for('main.projects') }}">Explore</a>
                        <a class="text-sm font-medium hover:text-primary dark:hover:text-primary" href="{{ url_for('main.new_project') }}">Create</a>
                    </nav>
                    <div class="flex items-center gap-4">
                        <button class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800">
                            <svg fill="currentColor" height="20px" viewBox="0 0 256 256" width="20px" xmlns="http://www.w3.org/2000/svg">
                                <path d="M221.8,175.94C216.25,166.38,208,139.33,208,104a80,80,0,1,0-160,0c0,35.34-8.26,62.38-13.81,71.94A16,16,0,0,0,48,200H88.81a40,40,0,0,0,78.38,0H208a16,16,0,0,0,13.8-24.06ZM128,216a24,24,0,0,1-22.62-16h45.24A24,24,0,0,1,128,216ZM48,184c7.7-13.24,16-43.92,16-80a64,64,0,1,1,128,0c0,36.05,8.28,66.73,16,80Z"></path>
                            </svg>
                        </button>
                        <div class="w-10 h-10 rounded-full bg-cover bg-center" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuBh7CV773gpkq_xzDV95Wntdc4I1A_JwVfaRRMUs9Wbg2aYjy0Fv60cB9qqZ1YNNJXXK-aX8SjSgA310EkoMlFvAwzDapiNKXZSGk3kNf7EB9oCRys1VbTYbEkwEPbk-lRowstDKX7EFTWvLuEQ3a8JFJyqkdw1rbX66nKFaOVcUI3X_mVErEe-i75NFLlGt7OUt5Jy4dP84wKw6JWo_6TR3HWW60IZDpXvyAs10VpOlyGrE5P0lNPRTHzx2RACxPATIlGzxpvAbdhK");'></div>
                    </div>
                </div>
            </div>
        </header>
        
        <main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="flex flex-col items-center justify-center text-center">
                <div class="mb-4 flex items-center gap-2 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 px-4 py-2 rounded-full">
                    <span class="material-symbols-outlined text-xl">check_circle</span>
                    <p class="font-medium">Success! Your moodboard is ready.</p>
                </div>
                <h2 class="text-4xl font-bold text-gray-900 dark:text-white">{{ moodboard.story or 'Neo-Noir Detective Film' }}</h2>
                <p class="mt-2 text-lg text-gray-600 dark:text-gray-400">Your visual masterpiece awaits. What's next?</p>
            </div>
            
            <div class="mt-8 grid grid-cols-2 md:grid-cols-4 gap-4 @container">
                {% for image in moodboard.images %}
                {% if loop.index == 1 %}
                <div class="col-span-1 rounded-xl overflow-hidden aspect-w-1 aspect-h-1">
                    <img alt="{{ image.prompt or 'Neo-noir city street at night with rain and neon signs.' }}" class="w-full h-full object-cover" src="{{ image.url }}"/>
                </div>
                {% elif loop.index == 2 %}
                <div class="col-span-1 rounded-xl overflow-hidden aspect-w-1 aspect-h-1">
                    <img alt="{{ image.prompt or 'Woman in a red dress looking out a window in a dimly lit room.' }}" class="w-full h-full object-cover" src="{{ image.url }}"/>
                </div>
                {% elif loop.index == 3 %}
                <div class="col-span-1 rounded-xl overflow-hidden aspect-w-1 aspect-h-1">
                    <img alt="{{ image.prompt or 'Close up of a detective\'s face, half in shadow.' }}" class="w-full h-full object-cover" src="{{ image.url }}"/>
                </div>
                {% elif loop.index == 4 %}
                <div class="col-span-1 rounded-xl overflow-hidden aspect-w-1 aspect-h-1">
                    <img alt="{{ image.prompt or 'Vintage car on a wet city street at night.' }}" class="w-full h-full object-cover" src="{{ image.url }}"/>
                </div>
                {% elif loop.index == 5 %}
                <div class="col-span-2 rounded-xl overflow-hidden aspect-w-2 aspect-h-1">
                    <img alt="{{ image.prompt or 'Abstract image of light trails and reflections, suggesting mystery.' }}" class="w-full h-full object-cover" src="{{ image.url }}"/>
                </div>
                {% elif loop.index == 6 %}
                <div class="col-span-1 rounded-xl overflow-hidden aspect-w-1 aspect-h-1">
                    <img alt="{{ image.prompt or 'Silhouette of a person in a fedora against a bright light.' }}" class="w-full h-full object-cover" src="{{ image.url }}"/>
                </div>
                {% elif loop.index == 7 %}
                <div class="col-span-1 rounded-xl overflow-hidden aspect-w-1 aspect-h-1">
                    <img alt="{{ image.prompt or 'Smoke-filled room with dramatic lighting.' }}" class="w-full h-full object-cover" src="{{ image.url }}"/>
                </div>
                {% endif %}
                {% endfor %}
            </div>
            
            <div class="mt-12 flex flex-col sm:flex-row items-center justify-center gap-4">
                <button class="w-full sm:w-auto flex items-center justify-center gap-2 px-6 py-3 text-white bg-primary rounded-lg hover:bg-primary/90 font-medium" onclick="downloadMoodboard()">
                    <span class="material-symbols-outlined">download</span>
                    Download
                </button>
                <button class="w-full sm:w-auto flex items-center justify-center gap-2 px-6 py-3 bg-gray-200 dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg hover:bg-gray-300 dark:hover:bg-gray-700 font-medium" onclick="shareMoodboard()">
                    <span class="material-symbols-outlined">share</span>
                    Share
                </button>
                <button class="w-full sm:w-auto flex items-center justify-center gap-2 px-6 py-3 bg-gray-200 dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg hover:bg-gray-300 dark:hover:bg-gray-700 font-medium" onclick="refineMoodboard()">
                    <span class="material-symbols-outlined">auto_fix_high</span>
                    Refine
                </button>
                <button class="w-full sm:w-auto flex items-center justify-center gap-2 px-6 py-3 bg-gray-200 dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg hover:bg-gray-300 dark:hover:bg-gray-700 font-medium" onclick="saveToProject()">
                    <span class="material-symbols-outlined">bookmark_add</span>
                    Save to Project
                </button>
            </div>
        </main>
    </div>

    <script>
    function downloadMoodboard() {
        // Implement download functionality
        alert('Download functionality will be implemented');
    }

    function shareMoodboard() {
        // Implement share functionality
        if (navigator.share) {
            navigator.share({
                title: 'My Visioneer Moodboard',
                text: 'Check out my AI-generated moodboard!',
                url: window.location.href
            });
        } else {
            // Fallback to copying URL
            navigator.clipboard.writeText(window.location.href).then(() => {
                alert('Moodboard URL copied to clipboard!');
            });
        }
    }

    function refineMoodboard() {
        // Get refine prompt from user
        const refinePrompt = prompt('Describe how you\'d like to refine your moodboard:');
        if (!refinePrompt) return;
        
        // Show loading state
        const refineBtn = event.target;
        const originalText = refineBtn.innerHTML;
        refineBtn.innerHTML = '<span class="material-symbols-outlined animate-spin">refresh</span> Refining...';
        refineBtn.disabled = true;
        
        // Get moodboard ID from URL
        const moodboardId = window.location.pathname.split('/').pop();
        
        // Send refine request
        fetch(`/moodboard/${moodboardId}/refine`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ refine_prompt: refinePrompt })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update images with refined versions
                updateImages(data.refined_images);
                alert('Moodboard refined successfully!');
            } else {
                alert('Failed to refine moodboard: ' + (data.error || 'Unknown error'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Failed to refine moodboard. Please try again.');
        })
        .finally(() => {
            // Restore button state
            refineBtn.innerHTML = originalText;
            refineBtn.disabled = false;
        });
    }

    function saveToProject() {
        // Get project name from user
        const projectName = prompt('Enter a name for your project:', 'My Moodboard Project');
        if (!projectName) return;
        
        // Show loading state
        const saveBtn = event.target;
        const originalText = saveBtn.innerHTML;
        saveBtn.innerHTML = '<span class="material-symbols-outlined animate-spin">refresh</span> Saving...';
        saveBtn.disabled = true;
        
        // Get moodboard ID from URL
        const moodboardId = window.location.pathname.split('/').pop();
        
        // Send save request
        fetch(`/moodboard/${moodboardId}/save`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ project_name: projectName })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message);
                // Optionally redirect to projects page
                // window.location.href = '/projects';
            } else {
                alert('Failed to save moodboard: ' + (data.error || 'Unknown error'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Failed to save moodboard. Please try again.');
        })
        .finally(() => {
            // Restore button state
            saveBtn.innerHTML = originalText;
            saveBtn.disabled = false;
        });
    }

    function updateImages(refinedImages) {
        // Update the image grid with refined images
        const imageGrid = document.querySelector('.grid');
        if (!imageGrid) return;
        
        // Clear existing images
        imageGrid.innerHTML = '';
        
        // Add refined images
        refinedImages.forEach((image, index) => {
            const imageDiv = document.createElement('div');
            imageDiv.className = index === 4 ? 'col-span-2 rounded-xl overflow-hidden aspect-w-2 aspect-h-1' : 'col-span-1 rounded-xl overflow-hidden aspect-w-1 aspect-h-1';
            
            imageDiv.innerHTML = `
                <img alt="${image.prompt}" class="w-full h-full object-cover" src="${image.url}"/>
            `;
            
            imageGrid.appendChild(imageDiv);
        });
    }
    </script>
</body>
</html>